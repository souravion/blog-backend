const adminService = require('../../services/AdminService')
const { AddAdminschema } = require('../../validation/addAdmin_validation_schema')
const createError = require('http-errors')
const bcrypt = require('bcrypt');
const { generatePassword } = require('../../utils/passwordGenerator.utils');

exports.AddAdminUserController = async (req, res, next) => {

    try{
        const password = generatePassword()
        const hashedPassword = await bcrypt.hash(password,10)
        const postParams = {
                    name:req.body.name,
                    email:req.body.email,
                    password:hashedPassword,
                    created_by:res.locals.userId
                }
        const result = await AddAdminschema.validateAsync(postParams)
        const doesExist = await adminService.FindUser(result.email)
        if (doesExist){
           throw createError.Conflict(`${result.email} is already been registered`)
            
        }else{
            await adminService.AdminUserCreate(postParams)
            return res.status(200).json({ 
            "status": 200,  
            "message": "User Succesfully Created" });
        }
        
    }catch(error){
        if(error.isJoi === true){
        error.status = 422
        next(error)
        }
        next(error)  
    }

}